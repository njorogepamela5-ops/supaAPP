export async function initiateStkPush(phone: string, amount: number) {
  const response = await fetch("https://mozjvtobsibktmndfqoz.supabase.co/functions/v1/stk_push", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ phone, amount }),
  });

  const data = await response.json();
  return data;
}
import { serve } from "https://deno.land/std@0.177.0/http/server.ts";
import { createClient } from "@supabase/supabase-js";

// Supabase environment variables (set these in Supabase secrets)
const supabaseUrl = Deno.env.get("SUPABASE_URL")!;
const supabaseKey = Deno.env.get("SUPABASE_SERVICE_ROLE_KEY")!;
const supabase = createClient(supabaseUrl, supabaseKey);

serve(async (req) => {
  try {
    const { phone, amount } = await req.json();

    if (!phone || !amount) {
      return new Response(
        JSON.stringify({ error: "phone and amount are required" }),
        { status: 400 }
      );
    }

    // TODO: Integrate M-Pesa STK Push API here
    console.log("STK Push Request:", { phone, amount });

    return new Response(
      JSON.stringify({ status: "success", message: "STK Push initiated" }),
      { status: 200 }
    );
  } catch (error) {
    console.error(error);
    return new Response(JSON.stringify({ error: error.message }), { status: 500 });
  }
});
